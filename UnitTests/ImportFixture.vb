Option Strict On
Option Explicit On

<TestFixture>
Public Class ImportFixture
    Private mobjCompany As Company

    <Test>
    Public Sub TestImportUpdateBank()
        Dim objTrx As BaseTrx
        Dim objUTReg As UTRegister

        gUTSetSubTest("Init register")

        objUTReg = gobjUTNewReg()
        With objUTReg
            .AddNormal("100", #4/3/2000#, -25D, "Add1", 1, 1, 1, strDescription:="Descr1", blnFake:=True, blnAutoGenerated:=True)
            .AddNormal("101", #4/4/2000#, -30.2D, "Add2", 2, 2, 2, strDescription:="Descr2", vcurAmount2:=-10D)
            .AddNormal("Pmt", #4/5/2000#, -20.99D, "Add3", 3, 3, 3, strDescription:="Descr3")
        End With

        gUTSetSubTest("Test first import")

        objUTReg.objReg.ImportUpdateBank(objUTReg.objReg.GetBankTrx(1), #4/3/2001#, "200", -25D, "importkey-1")
        objTrx = objUTReg.objReg.GetTrx(1)
        With DirectCast(objTrx, BankTrx)
            gUTAssert(.TrxDate = #4/3/2000#, "Bad date")
            gUTAssert(.Number = "200", "Bad number")
            gUTAssert(.Amount = -25D, "Bad amount")
            gUTAssert(.ImportKey = "importkey-1", "Bad import key")
            gUTAssert(.IsFake = False, "Bad blnFake")
            gUTAssert(.IsAutoGenerated = False, "Bad auto generated")
        End With

        gUTSetSubTest("Test second import")

        objUTReg.objReg.ImportUpdateBank(objUTReg.objReg.GetBankTrx(2), #4/4/2000#, "201", -50D, "importkey-2")
        objTrx = objUTReg.objReg.GetTrx(2)
        With objTrx
            gUTAssert(.TrxDate = #4/4/2000#, "Bad date")
            gUTAssert(.Number = "201", "Bad number")
            gUTAssert(.Amount = -50D, "Bad amount " & .Amount)
            gUTAssert(.IsFake = False, "Bad blnFake")
            gUTAssert(.IsAutoGenerated = False, "Bad auto generated")
        End With

        gUTSetSubTest("Test third import")

        objUTReg.objReg.ImportUpdateBank(objUTReg.objReg.GetBankTrx(3), #4/15/2002#, "Pmt", -40.01D, "importkey-3")
        objTrx = objUTReg.objReg.GetTrx(3)
        With objTrx
            gUTAssert(.TrxDate = #4/15/2002#, "Bad date")
            gUTAssert(.Number = "Pmt", "Bad number")
            gUTAssert(.Amount = -40.01, "Bad amount " & .Amount)
        End With

    End Sub

    <OneTimeSetUp>
    Public Sub OneTimeSetup()
        mobjCompany = gobjUTStandardSetup()
    End Sub

    <OneTimeTearDown>
    Public Sub OneTimeTearDown()
        gUTStandardTearDown(mobjCompany)
    End Sub

End Class
